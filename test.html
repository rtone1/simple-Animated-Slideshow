<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title></title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <style media="screen">
      *{
        margin: 0px;
        padding: 0px;
      }
      .box1{
        position: fixed;
        top: 0px;
        z-index: -1;
        background-color: red;
        width: 100%;
        height: 300px;
      }
      .parabox{
        position: relative;
        top: 300px;
        width: 100px;
        height: 100px;
        z-index: 10;
        background-color: purple;
      }
      .box2{
        position: absolute;
        z-index: -2;
        top: 0px;
        background-color: gray;
        width: 100%;
        height: 3000px;
      }
      @media only screen and ( max-width: 900px ){
        .box1{
          background-color: orange;
          height: 200px;
        }
        /*.parabox{
          background-color: red;
          height: 100px;
          width: 100px;
          top: 200px;
        }*/
      }

    </style>
  </head>
  <body>

      <div class="box1">

      </div>
      <div class="parabox">

      </div>
      <div class="box2">

      </div>


    <script type="text/javascript">

  var responsive = function(){
    $(window).resize(function(){
      if($(window).width() < 900){
        $('.parabox').css({top: 200});
      }else{
        $('.parabox').css({top: 300});
      }
    })
  }
responsive();
  var followTo = function (target, pos ) {

        $(window).scroll(function(){

          var scrolled = $(window).scrollTop();
          var obj = $('.parabox');
          var box = $('.box1').height();
          //console.log(scrolled);

            if (scrolled > pos) {
                target.css({ position: 'absolute', top: pos });
                $(obj).css({position: 'absolute', top: pos + box - 100 }); // parallax
            } else {
                target.css({ position: 'fixed', top: 0 });
                if(scrolled > 50){
                  $(obj).css({position: 'fixed', top: box - 100 }); // parallax
                } else if (scrolled < 100){
                  $(obj).css({position: 'absolute', top: -scrolled + 300 }); // parallax
                }
            } // end of delay scroll

            if ($( window ).width() < 900){
              if (scrolled > pos) {
                  $(obj).css({position: 'absolute', top: pos + box - 100 }); // parallax
              } else {
                  if(scrolled > 50){
                    $(obj).css({position: 'fixed', top: box - 100 }); // parallax
                  } else if (scrolled < 100){
                    $(obj).css({position: 'absolute', top: -scrolled + 200 }); // parallax
                  }
              }
            }// end of window width

        });// end of scroll


    };


    followTo($('.box1'), 400);
    </script>
  </body>
</html>
